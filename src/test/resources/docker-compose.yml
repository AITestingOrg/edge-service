version: '3'

services:
#
#  edge-service:
#    build: ./
#    ports:
#      - "8080:8080"
#    depends_on:
#      - discovery-service

  discovery-service:
    image: springcloud/eureka
    ports:
      - "8761:8761"
    container_name: eureka-server

#  hystrix-dashboard:
#    image: kbastani/hystrix-dashboard
#    container_name: hystrix-dashboard
#    environment:
#      - SPRING_PROFILES_ACTIVE=docker
#    ports:
#      - 6161:6161

#  redis:
#    image: redis:3.0
#    container_name: redis
#    ports:
#      - 6379:6379

#  config-service:
#    build: config-service
#    container_name: config-service
#    environment:
#      - SPRING_PROFILES_ACTIVE=docker
#    ports:
#      - 8888:8888

  mysql:
    depends_on:
      - discovery-service
    image: mysql:5.7
    container_name: mysql-docker.dev
    volumes:
      # Create persistent data in Host Hard Drive
      - /Users/eriny/microservice--trip-management/mysql-data:/var/lib/mysql:rw
    restart: always
    ports:
      - '3306:3306'
    environment:
      MYSQL_ROOT_PASSWORD: 'root'
      MYSQL_DATABASE: 'tripmanagementdb'

  db:
    depends_on:
      - discovery-service
    image: mysql:5.7
    container_name: paymentdb.dev
    restart: always
    volumes:
      # Create persistent data in Host Hard Drive
      - /Users/eriny/microservice--payment-services/mysql-data:/var/lib/mysql:rw
    ports:
      - '3307:3307'
    environment:
      MYSQL_ROOT_PASSWORD: 'password'
      MYSQL_DATABASE: 'payment'
#      MYSQL_USER: 'admin'
#      MYSQL_PASSWORD: 'password'

  microservice--trip-management:
    build: /Users/eriny/microservice--trip-management/
    depends_on:
      - discovery-service
      - mysql
    container_name: microservice--trip-management.dev
    ports:
      - '8181:8181'

  microservice--payment-services:
    build: /Users/eriny/microservice--payment-services/
    depends_on:
      - discovery-service
      - db
    container_name: microservice--payment-services.dev
    ports:
      - '8082:8082'

  microservice--passenger-management:
      build: /Users/eriny/microservice--passenger-management/
      depends_on:
        - discovery-service
        - mysql
      container_name: microservice--passenger-management.dev
      ports:
        - '8089:8089'